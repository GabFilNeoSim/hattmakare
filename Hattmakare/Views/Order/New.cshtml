@using Hattmakare.Models.Order;
<<<<<<< Updated upstream
@using Hattmakare.Models.Hats;
=======
@using Hattmakare.Models.Customer;
>>>>>>> Stashed changes

@model NewOrderIndexViewModel;

    @{
        ViewBag.Title = "Ny order";
    }

<div id="hat" class="order">
    <div id="hatList">
            @foreach (var hat in Model.Hats)
            {
            <div class="hatItem" data-name="@hat.Name" data-id="@hat.Id">
                <img src="/assets/hats/@(hat.ImageUrl ?? "placeholder-image.png")" />
                <h2 class="name">@hat.Name</h2>
                <div class="details">
                    <div class="item">
                        <p>Storlek: </p>
                        <p class="size">@hat.Size</p>
                    </div>
                    <div class="item">
                        <p>Pris: </p>
                        <p class="price">@hat.Price:-</p>
                    </div>
                </div>
                <div class="counter">
                    <button class="count-remove">-</button>
                    <p class="count">0</p>
                    <button class="count-add">+</button>
                </div>
            </div>
            }
    </div>

    <div class="container d-flex justify-content-center">
        <div class="col-md-8 col-lg-6">
            <form enctype="multipart/form-data" class="p-4 shadow rounded bg-light">
                <h2 class="mb-4 text-center">Skapa en specialhatt</h2>

                <div class="form-group mb-3">
                    <label for="Name" class="form-label fw-bold">Hattens namn</label>
                    <input id="Name" class="form-control" placeholder="Skriv namn på hatten" required />
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="Price" class="form-label fw-bold">Pris</label>
                        <input id="Price" type="number" class="form-control" placeholder="Ange pris i SEK" required />
                    </div>
                    <div class="col-md-6">
                        <label for="Quantity" class="form-label fw-bold">Antal</label>
                        <input id="Quantity" type="number" class="form-control" placeholder="Hur många ska beställas?" required />
                    </div>
                </div>

                <div class="form-group mb-3">
                    <label for="Size" class="form-label fw-bold">Storlek</label>
                    <input id="Size" class="form-control" placeholder="Ange storlek (t.ex. S, M, L, 58cm...)" required />
                </div>

                <div class="row mb-3">
                    <div class="col-md-4">
                        <label for="Length" class="form-label fw-bold">Längd</label>
                        <input id="Length" class="form-control" placeholder="cm" required />
                    </div>
                    <div class="col-md-4">
                        <label for="Depth" class="form-label fw-bold">Djup</label>
                        <input id="Depth" class="form-control" placeholder="cm" required />
                    </div>
                    <div class="col-md-4">
                        <label for="Width" class="form-label fw-bold">Bredd</label>
                        <input id="Width" class="form-control" placeholder="cm" required />
                    </div>
                </div>

                <div class="form-group mb-3">
                    <label for="Comment" class="form-label fw-bold">Beskrivning</label>
                    <input id="Comment" class="form-control" placeholder="Ange en beskrivning" required />
                </div>

                <div class="form-group mb-4">
                    <label for="Image" class="form-label fw-bold">Ladda upp bild</label>
                    <input id="Image" type="file" class="form-control" />
                </div>

                <h4 class="mt-4">Materialval</h4>

                <div id="material-selection" class="mb-3">
                    <div class="input-group material-group">
                        <select id="material-dropdown" class="form-select">
                            <option value="">-- Välj material --</option>
                                @foreach (var mat in Model.AvailableMaterials)
                                {
                                <option value="@mat.MaterialId" data-name="@mat.Name" data-unit="@mat.Unit">@mat.Name (@mat.Unit)</option>
                                }
                        </select>
                        <input type="number" id="material-qty" class="form-control" placeholder="Mängd" min="1" />
                        <button type="button" id="add-material-btn" class="btn btn-blue btn-sm">
                            <i class="fa-solid fa-plus"></i>
                            Lägg till
                        </button>
                    </div>
                </div>

                <ul id="material-list" class="list-group mb-3"></ul>

                <div class="text-end">
                    <button type="submit" class="btn btn-blue px-4 mt-4 text-light">
                        <i class="fa-solid fa-plus"></i>
                        Skapa hatt
                    </button>
                </div>

                    @section Scripts {
                    <script>
                        const dropdown = document.getElementById('material-dropdown');
                        const qtyInput = document.getElementById('material-qty');
                        const addBtn = document.getElementById('add-material-btn');
                        const list = document.getElementById('material-list');

                        let index = 0;

                        addBtn.addEventListener('click', () => {
                            const id = dropdown.value;
                            const name = dropdown.options[dropdown.selectedIndex].dataset.name;
                            const unit = dropdown.options[dropdown.selectedIndex].dataset.unit;
                            const qty = qtyInput.value;

                            if (!id || qty < 1) return;

                            // Create list item UI
                            const li = document.createElement('li');
                            li.className = 'list-group-item d-flex justify-content-between align-items-center';
                            li.innerHTML = `
                                        ${name} - ${qty} ${unit}
                                <button type="button" class="btn btn-sm btn-danger ms-2" onclick="this.parentElement.remove()">
                                            <i class="fa-solid fa-xmark"></i>
                                </button>
                                <input type="hidden" name="SelectedMaterials[${index}].MaterialId" value="${id}" />
                                <input type="hidden" name="SelectedMaterials[${index}].Quantity" value="${qty}" />
                            `;
                            list.appendChild(li);

                            index++;
                            qtyInput.value = '';
                            dropdown.selectedIndex = 0;
                        });
                    </script>
                    }
            </form>
        </div>
    </div>


    <div id="cartContainer">
        <div id="cart">
        </div>
        <p id="total">Total: 0:- </p>
    </div>

    <div id="settings" class="container mt-5">
        <form asp-action="CreateOrder" asp-controller="Order" method="post" enctype="multipart/form-data">

            <div>
                <label class="form-label fw-bold" for="CustomerId">Välj kund</label>
                <select id="CustomerId" class="form-select" asp-for="CustomerId" asp-items="Model.Customers">
                    <option value="">Ny kund</option>
                </select>
            </div>

            <div class="customerFields">
                <input type="hidden" asp-for="CustomerId" />

                <div class="formGroup">
                    <div class="formItem">
                        <label class="form-label fw-bold" for="FirstName">Förnamn:</label>
                        <input id="FirstName" class="form-control" asp-for="AddCustomer.FirstName" />
                        <span class="text-danger" asp-validation-for="AddCustomer.FirstName"></span>
                    </div>

                    <div class="formItem">
                        <label class="form-label fw-bold" for="LastName">Efternamn:</label>
                        <input id="LastName" class="form-control" asp-for="AddCustomer.LastName" />
                        <span class="text-danger" asp-validation-for="AddCustomer.LastName"></span>
                    </div>

                    <div class="formItem">
                        <label class="form-label fw-bold" for="HeadMeasurements">Huvudmått:</label>
                        <input id="HeadMeasurements" class="form-control" asp-for="AddCustomer.HeadMeasurements" />
                        <span class="text-danger" asp-validation-for="AddCustomer.HeadMeasurements"></span>
                    </div>
                </div>

                <div class="formItem">
                    <label class="form-label fw-bold" for="BillingAddress">Faktureringsadress:</label>
                    <input id="BillingAddress" class="form-control" asp-for="AddCustomer.BillingAddress" />
                    <span class="text-danger" asp-validation-for="AddCustomer.BillingAddress"></span>
                </div>

                <div class="formItem">
                    <label class="form-label fw-bold" for="DeliveryAddress">Leveransadress:</label>
                    <input id="DeliveryAddress" class="form-control" asp-for="AddCustomer.DeliveryAddress" />
                    <span class="text-danger" asp-validation-for="AddCustomer.DeliveryAddress"></span>
                </div>

                <div class="formGroup">
                    <div class="formItem">
                        <label class="form-label fw-bold" for="City">Stad:</label>
                        <input id="City" class="form-control" asp-for="AddCustomer.City" />
                        <span class="text-danger" asp-validation-for="AddCustomer.City"></span>
                    </div>

                    <div class="formItem">
                        <label class="form-label fw-bold" for="PostalCode">Postnummer:</label>
                        <input id="PostalCode" class="form-control" asp-for="AddCustomer.PostalCode" />
                        <span class="text-danger" asp-validation-for="AddCustomer.PostalCode"></span>
                    </div>

                    <div class="formItem">
                        <label class="form-label fw-bold" for="Country">Land:</label>
                        <input id="Country" class="form-control" asp-for="AddCustomer.Country" />
                        <span class="text-danger" asp-validation-for="AddCustomer.Country"></span>
                    </div>
                </div>

                <div class="formItem">
                    <label class="form-label fw-bold" for="Email">Email:</label>
                    <input id="Email" class="form-control" asp-for="AddCustomer.Email" />
                    <span class="text-danger" asp-validation-for="AddCustomer.Email"></span>
                </div>

                <div class="phoneNumber">
                    <label class="form-label fw-bold" for="Phone">Telefonnummer:</label>
                    <input id="Phone" class="form-control" asp-for="AddCustomer.Phone" />
                    <span class="text-danger" asp-validation-for="AddCustomer.Phone"></span>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <label class="form-label fw-bold" for="StartDate">Startdatum</label>
                    <input id="StartDate" type="date" class="form-control" asp-for="NewOrders.StartDate" />
                </div>
                <div class="col-md-6">
                    <label class="form-label fw-bold" for="EndDate">Slutdatum</label>
                    <input id="EndDate" type="date" class="form-control" asp-for="NewOrders.EndDate" />
                </div>
            </div>

            <div class="form-check">
                <input id="Priority" class="form-check-input" type="checkbox" asp-for="NewOrders.Priority" />
                <label class="form-check-label fw-bold" for="Priority">
                    Markera som högprioriterad order
                </label>
            </div>

            <div class="text-end">
                <button id="createOrderBtn" type="submit" class="btn btn-dark px-4">
                    Skapa order
                </button>

            </div>

        </form>
    </div>
</div>

<div id="orderCompleted" style="display:none;">
    <div id="confirm-wrapper">
        <div id="confirm-modal">
            <h3>Order är lagd!</h3>
            <div id="confirm-btn1">
                <button class="btn btn-blue" id="confirm-yes">Ok</button>
            </div>
        </div>
    </div>
</div>